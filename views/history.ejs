<% include ./partials/header %>
<body>
    <br>
    <br>
    <div class="container">
        <div class="container">
            <header class="jumbotron">
                <div class="container">
                    <h1>View all Your Transaction History On this Page!!</h1>
                        <p>Track Your Daily Expenses Using this simple Web Application!!!</p>
                        <h4>Hello <%=currentUser.username%></h4>
                </div>
            </header>
        </div>
        <div class="row justify-content-md-center">
        <div class="col-md-6">
            <canvas id="myBarChart"></canvas>
            <br><br>
            <canvas id="myLineChart"></canvas>  
        </div>
        <div class="col col-lg-6">
            <!--<div class="dropdown">-->
            <!--  <button class="btn btn-secondary dropdown-toggle" type="button" id="timeSpan" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-->
            <!--    TimeLine-->
            <!--  </button>-->
            <!--  <div class="dropdown-menu" aria-labelledby="dropdownMenu2">-->
            <!--    <button class="dropdown-item" type="button" value="Today">Today</button>-->
            <!--    <button class="dropdown-item" type="button" value="Yesterday">Yesterday</button>-->
            <!--    <button class="dropdown-item" type="button" value="All Time">All Time</button>-->
            <!--  </div>-->
            <!--</div>-->
            <select id="timeSpan" onchange="myFunction()">
                <option selected disabled hidden>Choose an option</option>
                <option id="Today" value="Today">Today</option>
                <option id="Yesterday" value="Yesterday">Yesterday</option>
                <option id="All Time" value="All Time">All Time</option>
            </select>
            <br><br>
            <div id='div1'></div>
            <script>
                function myFunction(){
                    var x = document.getElementById("timeSpan").value
                    if(x==="Today"){
                        document.getElementById("div1").innerHTML = `<table class="table table-dark">
                        <tr>
                            <th>Category</th>
                            <th>Amount</th>
                        </tr> 
                        <% for(var i = 0; i< categoryNameToday.length; i++){%>
                        <tr>
                            <td><%=categoryNameToday[i]%></td>
                            <td><%=categoryAmountToday[i]%></td>
                        </tr>
                        <% } %>
                        </table>`; 
                        drawForToday();
                    }
                    if(x==="Yesterday"){
                        document.getElementById("div1").innerHTML = `<table class="table table-dark">
                        <tr>
                            <th>Category</th>
                            <th>Amount</th>
                        </tr> 
                        <% for(var i = 0; i< categoryNameToday.length; i++){%>
                        <tr>
                            <td><%=categoryNameToday[i]%></td>
                            <td><%=categoryAmountToday[i]%></td>
                        </tr>
                        <% } %>
                        </table>`; 
                        drawForYesterday();
                    }
                }
                //alert(document.getElementById("timeSpan").value)
                // if(document.getElementById("timeSpan").value==="Today"){
                //     document.write("<table style= 'margin:25px auto'><tr><th>Amount</th><th>Category</th></tr></table>");
                // }
            </script>
            <br><br>
        </div>
    </div>
</div>
<script>
var ctx1 = document.getElementById("myBarChart").getContext('2d');
var ctx2 = document.getElementById("myLineChart").getContext('2d');
    
function drawForToday(){
    var myBarChart = new Chart(ctx1,{
    type: 'bar',
    maintainAspectRatio:this.maintainAspectRatio,
    data : {
    labels: <%- JSON.stringify(categoryNameToday)%>,
    datasets: [{
        label: 'Category',
        data: [<%=categoryAmountToday%>],
        backgroundColor: palette('tol', <%=categoryAmount.length%>).map((hex) => '#'+hex)
    }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});

var myLineChart = new Chart(ctx2,{
    type:"line",
    data:{
        labels:<%- JSON.stringify(categoryNameToday) %>,
        datasets:[{
            label:"My First Dataset",
            data:[<%=categoryAmountToday%>],
            fill:false,
            borderColor:"rgb(75, 192, 192)",
            lineTension:0.1
        }
    ]},
});
}
function drawForYesterday(){
    var myBarChart = new Chart(ctx1,{
    type: 'bar',
    maintainAspectRatio:this.maintainAspectRatio,
    data : {
    labels: <%- JSON.stringify(categoryNameYesterday)%>,
    datasets: [{
        label: 'Category',
        data: [<%=categoryAmountYesterday%>],
        backgroundColor: palette('tol', <%=categoryAmountYesterday.length%>).map((hex) => '#'+hex)
    }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});

var myLineChart = new Chart(ctx2,{
    "type":"line",
    "data":{
        "labels":[<%=categoryNameYesterday%>],
        "datasets":[{
            "label":"My First Dataset",
            "data":[<%=categoryAmountYesterday%>],
            "fill":false,
            "borderColor":"rgb(75, 192, 192)",
            "lineTension":0.1
        }
    ]},
});
}
function drawForAll_Time(){
    var myBarChart = new Chart(ctx1,{
    type: 'bar',
    maintainAspectRatio:this.maintainAspectRatio,
    data : {
    labels: <%- JSON.stringify(categoryName)%>,
    datasets: [{
        label: 'Category',
        data: [<%=categoryAmount%>],
        backgroundColor: palette('tol', <%=categoryAmount.length%>).map((hex) => '#'+hex)
    }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});

var myLineChart = new Chart(ctx2,{
    "type":"line",
    "data":{
        "labels":[<%=categoryName%>],
        "datasets":[{
            "label":"My First Dataset",
            "data":[<%=categoryAmount%>],
            "fill":false,
            "borderColor":"rgb(75, 192, 192)",
            "lineTension":0.1
        }
    ]},
});

}
</script>
</body>
<% include ./partials/footer %>